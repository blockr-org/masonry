(()=>{"use strict";Shiny;const t=()=>"_"+Math.ceil(1e7*Math.random()),e={},n=t=>e[t.replace("#","")],r=(t,n)=>{const r=$(t).attr("id");n.group=r,((t,n)=>{e[`#${t}`]=n})(r,n),a(t,n),((t,e)=>{$(t).find(".masonry-item").on("mouseup",(t=>{$(t.target).trigger("resize")}))})(t),$(t).addClass("masoned"),d(t,n),m($(t).find(".masonry-grid-content"),n)},a=(t,e)=>{$(t).find(".masonry-row").each(((t,n)=>{i(n,e)}))},i=(e,n)=>{const r=$(e).data("masonry-minheight");$(e).css("min-height",r);const a=$(e).data("masonry-height");if(a&&$(e).css("height",a),n.rows)for(const t in n.rows)$(e).css(t,n.rows[t]);$(e).attr("id")||$(e).attr("id",t()),y(e,n),s(e,n),d(e,n)},s=(t,e)=>{$(t).find(".masonry-item").each(((t,n)=>{o(n,e)}))},o=(e,n)=>{if(n.items)for(const t in n.items)$(e).css(t,n.items[t]);let r=$(e).data("masonry-width");if(r||(r=20),$(e).css("width",`${r}%`),$(e).attr("id"))return;let a=t();$(e).attr("id",a)},d=(t,e)=>{let n={multiDrag:!1,fallbackTolerance:2,animation:150,swap:!1,draggable:".masonry-item",onEnd:t=>{$(t.item).closest(".masonry-row").trigger("resize")}};e.group&&(n.group=e.group),new Sortable(t,n)},m=(t,e)=>{let n={multiDrag:!1,fallbackTolerance:2,animation:150,swap:!1,draggable:".masonry-row",onEnd:t=>{$(t.item).trigger("resize")}};new Sortable(t[0],n)},y=(t,e)=>{let n=[];if($(t).find(".masonry-item").each(((t,e)=>{n.push($(e).data("masonry-width")||.2)})),0==n.length)return;let r=n.reduce(((t,e)=>t+e));if(r<100){let e=100-r;$(t).find(".masonry-item").last().data("masonry-width",n[n.length-1]+e)}let a=r-100;$(t).find(".masonry-item").last().data("masonry-width",n[n.length-1]-a)};var g=new Shiny.OutputBinding;$.extend(g,{find:function(t){return $(t).find(".masonry-grid-shiny")},renderValue:function(t,e){Shiny.renderContentAsync(t,e.content).then((()=>{$(t).masonry(e.options)}))}}),Shiny.outputBindings.register(g,"masonry.masonry");jQuery.fn.extend({masonry:function(t){((t,e)=>{Array.isArray(e)&&(e=null),((t,e)=>{$(t).hasClass("masonry-grid")?r(t[0],e):$(t).find(".masonry-grid").each(((t,n)=>{r(n,e)}))})(t,e=e||$(t).data("styles")||{})})(this,t)}}),Shiny.addCustomMessageHandler("masonry-add-row",(e=>{e.id=t();let r=`<div id="${e.id}" class='masonry-row d-flex ${e.classes}'></div>`,a=$(`${e.target}`).find(".masonry-grid-content");"bottom"==e.position&&a.append(r),"top"==e.position&&a.prepend(r),Shiny.renderContentAsync($(`#${e.id}`),e.content).then((()=>{const t=n(e.target);$(`${e.target}`).masonry(t);const r=new CustomEvent("masonry:added-row",{detail:e.id});document.dispatchEvent(r)}))})),Shiny.addCustomMessageHandler("masonry-add-item",(e=>{e.id=t();let r,a=`<div id="${e.id}" class='masonry-item ${e.classes}'></div>`;e.row_id||(r=$(`${e.target}`).find(".masonry-grid-content").find(`.masonry-row:eq(${e.row_index})`)),e.row_id&&(r=$(`${e.row_id}`)),"end"==e.position&&r.append(a),"start"==e.position&&r.prepend(a),Shiny.renderContentAsync($(`#${e.id}`),e.item).then((()=>{let t=n(e.target);$(`${e.target}`).masonry(t);const r=new CustomEvent("masonry:added-item");document.dispatchEvent(r)}))})),Shiny.addCustomMessageHandler("masonry-remove-item",(t=>{$(`${t.target}`).find(".masonry-grid-content").find(`.masonry-row:eq(${t.row_index})`).find(`.masonry-item:eq(${t.item_index})`).remove()})),Shiny.addCustomMessageHandler("masonry-remove-row",(t=>{$(`${t.target}`).find(".masonry-grid-content").find(`.masonry-row:eq(${t.row_index})`).remove()})),Shiny.addCustomMessageHandler("masonry-get-config",(t=>{let e=[];$(`#${t.target}`).find(".masonry-row").each(((t,n)=>{let r=[];$(n).find(".masonry-item").each(((t,e)=>{let n={width:(a=e,$(a).width()),id:$(e).attr("id")};var a;r.push(n)}));let a=r.map((t=>t.width)).reduce(((t,e)=>t+e));r=r.map((t=>(t.percentage=((t,e)=>Math.round(t/e*100))(t.width,a),t)));let i={id:$(n).attr("id"),items:r};e.push(i)}));let r={opts:n(`#${t.target}`),grid:e};Shiny.setInputValue(`${t.target}_config:force.raw`,r)})),Shiny.addCustomMessageHandler("masonry-restore-config",(t=>{(t=>{t.config.grid.map(((e,n)=>{$(`#${t.target}`).find(`.masonry-row:eq(${n})`).attr("id");const r=e.id;e.items.map(((e,n)=>{$(`#${t.target}`).find(`.masonry-item:eq(${n})`).attr("id");const a=e.id;$(`#${a}`).appendTo(`#${r}`)}))}))})(t),$(`#${t.target}`).find(".masonry-row").each(((e,n)=>{$(n).find(".masonry-item").each(((n,r)=>{$(r).css("width",`${t.config.grid[e].items[n].percentage}%`),$(r).trigger("resize")}))}))})),Shiny.addCustomMessageHandler("masonry-run",(t=>{$(t.target).masonry()}))})();