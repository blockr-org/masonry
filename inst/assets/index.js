(()=>{"use strict";Shiny;const t={},e=(e,n)=>{t[e]=n},n=e=>t[e.replace("#","")],r=t=>{let e=[];$(`#${t.target}`).find(".masonry-row").each(((t,n)=>{let r=[];$(n).find(".masonry-item").each(((t,e)=>{let n=[];$(e).children().each(((t,e)=>{n.push(e)}));let i="";n.length>0&&(i=$(n[0]).attr("id"));let o={width:a(e),id:$(e).attr("id"),childId:i};r.push(o)}));let o=r.map((t=>t.width)).reduce(((t,e)=>t+e),0);r=r.map((t=>(t.percentage=i(t.width,o),t)));let s={id:$(n).attr("id"),items:r};e.push(s)}));let r={opts:n(`#${t.target}`),grid:e};window.Shiny.setInputValue(`${t.target}_config:force.raw`,r)},i=(t,e)=>Math.round(t/e*100),a=t=>{let e=$(t).css("width").replace("%","");return e?parseInt(e):$(t).width()||0},o=()=>"_"+Math.ceil(1e7*Math.random()),s=(t,n)=>{const i=$(t).attr("id");n.group=i,e(i,n),d(t,n),((t,e)=>{$(t).find(".masonry-item").on("mouseup",(t=>{$(t.target).trigger("resize")}))})(t),$(t).addClass("masoned"),w(t,n),l($(t).find(".masonry-grid-content"),n),$(t).data("send")&&($(t).off("change resize"),$(t).on("change resize",(()=>{r({target:i})})))},d=(t,e)=>{$(t).find(".masonry-row").each(((t,n)=>{m(n,e)}))},m=(t,e)=>{if(e.rows)for(const n in e.rows)$(t).css(n,e.rows[n]);$(t).attr("id")||$(t).attr("id",o()),h(t,e),c(t,e),w(t,e)},c=(t,e)=>{$(t).find(".masonry-item").each(((t,n)=>{g(n,e)})),y(t)},g=(t,e)=>{if(e.items)for(const n in e.items)$(t).css(n,e.items[n]);const n=o();$(t).attr("id",n)},y=t=>{let e=[];$(t).find(".masonry-item").each(((t,n)=>e.push(a(n))));const n=e.reduce(((t,e)=>t+e),0);$(t).find(".masonry-item").each(((t,e)=>{$(e).css("width",i(a(e),n)+"%"),$(e).trigger("resize")}))},w=(t,e)=>{const n={multiDrag:!1,fallbackTolerance:2,animation:150,swap:!1,draggable:".masonry-item",onEnd:t=>{$(t.item).closest(".masonry-row").trigger("resize");const e=$(t.item).closest(".masonry-grid").attr("id");r({target:e})}};e.group&&(n.group=e.group),new window.Sortable(t,n)},l=(t,e)=>{const n={multiDrag:!1,fallbackTolerance:2,animation:150,swap:!1,draggable:".masonry-row",onEnd:t=>{$(t.item).trigger("resize");const e=$(t.item).closest(".masonry-grid").attr("id");r({target:e})}};new window.Sortable(t[0],n)},h=(t,e)=>{const n=[];if($(t).find(".masonry-item").each(((t,e)=>{n.push($(e).data("masonry-width")||.2)})),0==n.length)return;const r=n.reduce(((t,e)=>t+e),0);if(r<100){const e=100-r;$(t).find(".masonry-item").last().data("masonry-width",n[n.length-1]+e)}const i=r-100;$(t).find(".masonry-item").last().data("masonry-width",n[n.length-1]-i)},u=new window.Shiny.OutputBinding;$.extend(u,{find:function(t){return $(t).find(".masonry-grid-shiny")},renderValue:function(t,e){window.Shiny.renderContentAsync(t,e.content).then((()=>{$(t).masonry(e.options)}))}}),window.Shiny.outputBindings.register(u,"masonry.masonry"),jQuery.fn.extend({masonry:function(t){((t,e)=>{Array.isArray(e)&&(e=null),((t,e)=>{$(t).hasClass("masonry-grid")?s(t[0],e):$(t).find(".masonry-grid").each(((t,n)=>{s(n,e)}))})(t,e=e||$(t).data("styles")||{})})(this,t)}}),window.Shiny.addCustomMessageHandler("masonry-add-row",(t=>{t.id||(t.id=o());const e=`<div id="${t.id}" class='masonry-row d-flex ${t.classes}'></div>`,i=$(`${t.target}`).find(".masonry-grid-content");"bottom"==t.position&&i.append(e),"top"==t.position&&i.prepend(e),window.Shiny.renderDependenciesAsync(t.content.deps).then((()=>{window.Shiny.renderContentAsync($(`#${t.id}`),t.content.html).then((()=>{const e=n(t.target);$(`${t.target}`).masonry(e);const i=new CustomEvent("masonry:added-row",{detail:t.id});document.dispatchEvent(i),r({target:t.target.replace("#","")}),t.event_id&&window.Shiny.setInputValue(t.event_id,t)})).catch((t=>console.error(t)))})).catch((t=>console.error(t)))})),window.Shiny.addCustomMessageHandler("masonry-add-item",(t=>{t.id||(t.id=o());const e=`<div id="${t.id}" class='masonry-item ${t.classes}'></div>`;let i;t.row_id||(i=$(`${t.target}`).find(".masonry-grid-content").find(`.masonry-row:eq(${t.row_index})`)),t.row_id&&(i=$(`${t.row_id}`)),"end"==t.position&&i.append(e),"start"==t.position&&i.prepend(e),$(`#${t.id}`).html(t.item.deps);const a=n(t.target);$(`${t.target}`).masonry(a);const s=new CustomEvent("masonry:added-item",{detail:t.id});document.dispatchEvent(s),r({target:t.target.replace("#","")}),t.event_id&&window.Shiny.setInputValue(t.event_id,t)})),window.Shiny.addCustomMessageHandler("masonry-remove-item",(t=>{if(t.item_id)return void $(`#${t.item_id}`).remove();const e=$(`${t.target}`).closest(".masonry-grid").attr("id");$(`${t.target}`).find(".masonry-grid-content").find(`.masonry-row:eq(${t.row_index})`).find(`.masonry-item:eq(${t.item_index})`).remove(),r({target:e})})),window.Shiny.addCustomMessageHandler("masonry-remove-row",(t=>{const e=$(`${t.target}`).closest(".masonry-grid").attr("id");$(`${t.target}`).find(".masonry-grid-content").find(`.masonry-row:eq(${t.row_index})`).remove(),r({target:e})})),window.Shiny.addCustomMessageHandler("masonry-get-config",(t=>{setTimeout((()=>{r(t)}),t.delay||0)})),window.Shiny.addCustomMessageHandler("masonry-restore-config",(t=>{setTimeout((()=>{e(t.target,t.config?.opts),(t=>{t.config.grid.map(((e,n)=>{$(`#${t.target}`).find(`.masonry-row:eq(${n})`).attr("id");const r=e.id;e.items.map(((e,n)=>{$(`#${t.target}`).find(`.masonry-item:eq(${n})`).attr("id");const i=e.id;$(`#${i}`).appendTo(`#${r}`)}))}))})(t),$(`#${t.target}`).find(".masonry-row").each(((e,n)=>{$(n).find(".masonry-item").each(((n,r)=>{$(r).css("width",`${t.config.grid[e].items[n].percentage}%`),$(r).trigger("resize")}))})),n(`#${t.target}`)}),t.delay||0)})),window.Shiny.addCustomMessageHandler("masonry-run",(t=>{setTimeout((()=>{$(`${t.target}`).masonry()}),t.delay)}))})();