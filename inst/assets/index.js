(()=>{"use strict";Shiny;const t=()=>"_"+Math.ceil(1e7*Math.random()),e={},a=t=>e[t],n=(t,a)=>{const n=$(t).attr("id");a.group=n,((t,a)=>{e[`#${t}`]=a})(n,a),r(t,a),((t,e)=>{$(t).find(".masonry-item").on("mouseup",(t=>{$(t.target).trigger("resize")}))})(t),$(t).addClass("masoned"),d(t,a),m($(t).find(".masonry-grid-content"),a)},r=(t,e)=>{$(t).find(".masonry-row").each(((t,a)=>{i(a,e)}))},i=(e,a)=>{const n=$(e).data("masonry-minheight");$(e).css("min-height",n);const r=$(e).data("masonry-height");r&&$(e).css("height",r),$(e).attr("id")||$(e).attr("id",t()),g(e,a),s(e,a),d(e,a)},s=(t,e)=>{$(t).find(".masonry-item").each(((t,a)=>{o(a,e)}))},o=(e,a)=>{if(a.items)for(const t in a.items)$(e).css(t,a.items[t]);let n=$(e).data("masonry-width");if(n||(n=20),$(e).css("width",`${n}%`),$(e).attr("id"))return;let r=t();$(e).attr("id",r)},d=(t,e)=>{let a={multiDrag:!1,fallbackTolerance:2,animation:150,swap:!1,draggable:".masonry-item",onEnd:t=>{$(t.item).closest(".masonry-row").trigger("resize")}};e.group&&(a.group=e.group),new Sortable(t,a)},m=(t,e)=>{let a={multiDrag:!1,fallbackTolerance:2,animation:150,swap:!1,draggable:".masonry-row",onEnd:t=>{$(t.item).trigger("resize")}};new Sortable(t[0],a)},g=(t,e)=>{let a=[];if($(t).find(".masonry-item").each(((t,e)=>{a.push($(e).data("masonry-width")||.2)})),0==a.length)return;let n=a.reduce(((t,e)=>t+e));if(n<100){let e=100-n;$(t).find(".masonry-item").last().data("masonry-width",a[a.length-1]+e)}let r=n-100;$(t).find(".masonry-item").last().data("masonry-width",a[a.length-1]-r)};jQuery.fn.extend({masonry:function(t){((t,e)=>{((t,e)=>{$(t).hasClass("masonry-grid")?n(t[0],e):$(t).find(".masonry-grid").each(((t,a)=>{n(a,e)}))})(this,e=e||{})})(0,t)}}),Shiny.addCustomMessageHandler("masonry-add-row",(t=>{let e=`<div \n    class='masonry-row d-flex ${t.classes}'\n    data-masonry-minheight = ${t.min_height}\n    data-masonry-height = ${t.height}\n    ></div>`,n=$(`${t.target}`).find(".masonry-grid-content");"bottom"==t.position&&n.append(e),"top"==t.position&&n.prepend(e);const r=a(t.target);$(`${t.target}`).masonry(r)})),Shiny.addCustomMessageHandler("masonry-add-item",(t=>{let e=`<div class='masonry-item ${t.classes}'>${t.item}</div>`,n=$(`${t.target}`).find(".masonry-grid-content").find(`.masonry-row:eq(${t.row_index})`);"end"==t.position&&n.append(e),"start"==t.position&&n.prepend(e);let r=a(t.target);$(`${t.target}`).masonry(r)})),Shiny.addCustomMessageHandler("masonry-remove-item",(t=>{$(`${t.target}`).find(".masonry-grid-content").find(`.masonry-row:eq(${t.row_index})`).find(`.masonry-item:eq(${t.item_index})`).remove()})),Shiny.addCustomMessageHandler("masonry-remove-row",(t=>{$(`${t.target}`).find(".masonry-grid-content").find(`.masonry-row:eq(${t.row_index})`).remove()})),Shiny.addCustomMessageHandler("masonry-get-config",(t=>{let e=[];$(`#${t.target}`).find(".masonry-row").each(((t,a)=>{let n=[];$(a).find(".masonry-item").each(((t,e)=>{let a={width:(r=e,$(r).width()),id:$(e).attr("id")};var r;n.push(a)}));let r=n.map((t=>t.width)).reduce(((t,e)=>t+e));n=n.map((t=>(t.percentage=((t,e)=>Math.round(t/e*100))(t.width,r),t)));let i={id:$(a).attr("id"),items:n};e.push(i)}));let n={opts:a(`#${t.target}`),grid:e};Shiny.setInputValue(`${t.target}_config:force.raw`,n)})),Shiny.addCustomMessageHandler("masonry-restore-config",(t=>{(t=>{t.config.grid.map(((e,a)=>{$(`#${t.target}`).find(`.masonry-row:eq(${a})`).attr("id");const n=e.id;e.items.map(((e,a)=>{$(`#${t.target}`).find(`.masonry-item:eq(${a})`).attr("id");const r=e.id;$(`#${r}`).appendTo(`#${n}`)}))}))})(t),$(`#${t.target}`).find(".masonry-row").each(((e,a)=>{$(a).find(".masonry-item").each(((a,n)=>{$(n).css("width",`${t.config.grid[e].items[a].percentage}%`),$(n).trigger("resize")}))}))}))})();