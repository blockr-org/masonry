(()=>{"use strict";Shiny;const e=()=>"_"+Math.ceil(1e7*Math.random()),n={},a=e=>n[e],t=(e,a)=>{const t=$(e).attr("id");a.group=t,((e,a)=>{n[`#${e}`]=a})(t,a),i(e,a),((e,n)=>{$(e).find(".masonry-item").on("mouseup",(e=>{$(e.target).trigger("resize")}))})(e),$(e).addClass("masoned"),d(e,a)},i=(e,n)=>{$(e).find(".masonry-row").each(((e,a)=>{s(a,n)}))},s=(n,a)=>{const t=$(n).data("masonry-minheight");$(n).css("min-height",t);const i=$(n).data("masonry-height");i&&$(n).css("height",i),$(n).attr("id",e()),m(n,a),r(n,a),d(n,a)},r=(e,n)=>{$(e).find(".masonry-item").each(((e,a)=>{o(a,n)}))},o=(n,a)=>{a.padding&&$(n).css("padding",a.padding),a.margin&&$(n).css("margin",a.margin);let t=$(n).data("masonry-width");t||(t=20),$(n).css("width",`${t}%`);let i=e();$(n).attr("id",i)},d=(e,n)=>{let a={multiDrag:!1,fallbackTolerance:2,animation:150,swap:!1,onEnd:e=>{$(e.item).trigger("resize")}};n.group&&(a.group=n.group),new Sortable(e,a)},m=(e,n)=>{let a=[];if($(e).find(".masonry-item").each(((e,n)=>{a.push($(n).data("masonry-width")||.2)})),0==a.length)return;let t=a.reduce(((e,n)=>e+n));if(t<100){let n=100-t;$(e).find(".masonry-item").last().data("masonry-width",a[a.length-1]+n)}let i=t-100;$(e).find(".masonry-item").last().data("masonry-width",a[a.length-1]-i)};jQuery.fn.extend({masonry:function(e){((e,n)=>{((e,n)=>{$(e).hasClass("masonry-main")?t(e[0],n):$(e).find(".masonry-main").each(((e,a)=>{t(a,n)}))})(this,n=n||{})})(0,e)}}),Shiny.addCustomMessageHandler("masonry-add-row",(e=>{let n=`<div \n    class='masonry-row d-flex ${e.classes}'\n    data-masonry-minheight = ${e.min_height}\n    data-masonry-height = ${e.height}\n    ></div>`,t=$(`${e.target}`).find(".masonry-main-content");"bottom"==e.position&&t.append(n),"top"==e.position&&t.prepend(n);const i=a(e.target);$(`${e.target}`).masonry(i)})),Shiny.addCustomMessageHandler("masonry-add-item",(e=>{let n=`<div class='masonry-item ${e.classes}'>${e.item}</div>`,t=$(`${e.target}`).find(".masonry-main-content").find(`.masonry-row:eq(${e.row_index})`);"end"==e.position&&t.append(n),"start"==e.position&&t.prepend(n);let i=a(e.target);$(`${e.target}`).masonry(i)})),Shiny.addCustomMessageHandler("masonry-remove-item",(e=>{$(`${e.target}`).find(".masonry-main-content").find(`.masonry-row:eq(${e.row_index})`).find(`.masonry-item:eq(${e.item_index})`).remove()})),Shiny.addCustomMessageHandler("masonry-remove-row",(e=>{$(`${e.target}`).find(".masonry-main-content").find(`.masonry-row:eq(${e.row_index})`).remove()})),Shiny.addCustomMessageHandler("masonry-get-config",(e=>{let n=[];$(`#${e.target}`).find(".masonry-row").each(((e,a)=>{let t=[];$(a).find(".masonry-item").each(((e,n)=>{let a={width:(i=n,$(i).width())};var i;t.push(a)}));let i=t.map((e=>e.width)).reduce(((e,n)=>e+n));t=t.map((e=>(e.percentage=((e,n)=>Math.round(e/n*100))(e.width,i),e))),n.push(t)}));let t={opts:a(`#${e.target}`),dimensions:n};Shiny.setInputValue(`${e.target}_config:force.raw`,t)})),Shiny.addCustomMessageHandler("masonry-restore-config",(e=>{console.log(e),$(`#${e.target}`).find(".masonry-row").each(((n,a)=>{$(a).find(".masonry-item").each(((a,t)=>{$(t).css("width",`${e.config.dimensions[n][a].percentage}%`),$(t).trigger("resize")}))}))}))})();