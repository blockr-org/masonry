(()=>{"use strict";Shiny;const n={},e=(e,t)=>{n[e]=t},t=e=>n[e.replace("#","")],i=n=>{let e=[];$(`#${n.target}`).find(".masonry-row").each(((n,t)=>{let i=[];$(t).find(".masonry-item").each(((n,e)=>{let t=[];$(e).children().each(((n,e)=>{$(e).is(":visible")&&t.push(e)}));let r="";t.length>0&&(r=$(t[0]).attr("id"));let a={width:o(e),id:$(e).attr("id"),childId:r};i.push(a)}));let a=i.map((n=>n.width)).reduce(((n,e)=>n+e),0);i=i.map((n=>(n.percentage=r(n.width,a),n)));let d={id:$(t).attr("id"),items:i};e.push(d)}));let i={opts:t(`#${n.target}`),grid:e};window.Shiny.setInputValue(`${n.target}_config:force.raw`,i)},r=(n,e)=>Math.round(n/e*100),o=n=>$(n).width(),a=()=>"_"+Math.ceil(1e7*Math.random()),d=(n,t)=>{const r=$(n).attr("id");t.group=r,e(r,t),s(n,t),((n,e)=>{$(n).find(".masonry-item").on("mouseup",(n=>{$(n.target).trigger("resize")}))})(n),$(n).addClass("masoned"),g(n,t),w($(n).find(".masonry-grid-content"),t),$(n).data("send")&&($(n).off("change resize"),$(n).on("change resize",(()=>{i({target:r})})))},s=(n,e)=>{$(n).find(".masonry-row").each(((n,t)=>{m(t,e)}))},m=(n,e)=>{if(e.rows)for(const t in e.rows)$(n).css(t,e.rows[t]);$(n).attr("id")||$(n).attr("id",a()),h(n,e),c(n,e),g(n,e)},c=(n,e)=>{$(n).find(".masonry-item").each(((n,t)=>{y(t,e)}))},y=(n,e)=>{if(e.items)for(const t in e.items)$(n).css(t,e.items[t]);let t=$(n).data("masonry-width");if(t||(t=20),$(n).css("width",`${t}%`),$(n).attr("id"))return;const i=a();$(n).attr("id",i)},g=(n,e)=>{const t={multiDrag:!1,fallbackTolerance:2,animation:150,swap:!1,draggable:".masonry-item",onEnd:n=>{$(n.item).closest(".masonry-row").trigger("resize");const e=$(n.item).closest(".masonry-grid").attr("id");i({target:e})}};e.group&&(t.group=e.group),new window.Sortable(n,t)},w=(n,e)=>{const t={multiDrag:!1,fallbackTolerance:2,animation:150,swap:!1,draggable:".masonry-row",onEnd:n=>{$(n.item).trigger("resize");const e=$(n.item).closest(".masonry-grid").attr("id");i({target:e})}};new window.Sortable(n[0],t)},h=(n,e)=>{const t=[];if($(n).find(".masonry-item").each(((n,e)=>{t.push($(e).data("masonry-width")||.2)})),0==t.length)return;const i=t.reduce(((n,e)=>n+e),0);if(i<100){const e=100-i;$(n).find(".masonry-item").last().data("masonry-width",t[t.length-1]+e)}const r=i-100;$(n).find(".masonry-item").last().data("masonry-width",t[t.length-1]-r)},l=new window.Shiny.OutputBinding;$.extend(l,{find:function(n){return $(n).find(".masonry-grid-shiny")},renderValue:function(n,e){window.Shiny.renderContentAsync(n,e.content).then((()=>{$(n).masonry(e.options)}))}}),window.Shiny.outputBindings.register(l,"masonry.masonry"),jQuery.fn.extend({masonry:function(n){((n,e)=>{Array.isArray(e)&&(e=null),((n,e)=>{$(n).hasClass("masonry-grid")?d(n[0],e):$(n).find(".masonry-grid").each(((n,t)=>{d(t,e)}))})(n,e=e||$(n).data("styles")||{})})(this,n)}}),window.Shiny.addCustomMessageHandler("masonry-add-row",(n=>{n.id||(n.id=a());const e=`<div id="${n.id}" class='masonry-row d-flex ${n.classes}'></div>`,i=$(`${n.target}`).find(".masonry-grid-content");"bottom"==n.position&&i.append(e),"top"==n.position&&i.prepend(e),window.Shiny.renderDependenciesAsync(n.content.deps).then((()=>{window.Shiny.renderContentAsync($(`#${n.id}`),n.content.html).then((()=>{const e=t(n.target);$(`${n.target}`).masonry(e);const i=new CustomEvent("masonry:added-row",{detail:n.id});document.dispatchEvent(i)}))}))})),window.Shiny.addCustomMessageHandler("masonry-add-item",(n=>{n.id=a();const e=`<div id="${n.id}" class='masonry-item ${n.classes}'></div>`;let i;n.row_id||(i=$(`${n.target}`).find(".masonry-grid-content").find(`.masonry-row:eq(${n.row_index})`)),n.row_id&&(i=$(`${n.row_id}`)),"end"==n.position&&i.append(e),"start"==n.position&&i.prepend(e),window.Shiny.renderDependenciesAsync(n.item.deps).then((()=>{window.Shiny.renderContentAsync($(`#${n.id}`),n.item.html).then((()=>{const e=t(n.target);$(`${n.target}`).masonry(e);const i=new CustomEvent("masonry:added-item",{detail:n.id});document.dispatchEvent(i)}))}))})),window.Shiny.addCustomMessageHandler("masonry-remove-item",(n=>{n.item_id?$(`#${n.item_id}`).remove():$(`${n.target}`).find(".masonry-grid-content").find(`.masonry-row:eq(${n.row_index})`).find(`.masonry-item:eq(${n.item_index})`).remove()})),window.Shiny.addCustomMessageHandler("masonry-remove-row",(n=>{$(`${n.target}`).find(".masonry-grid-content").find(`.masonry-row:eq(${n.row_index})`).remove()})),window.Shiny.addCustomMessageHandler("masonry-get-config",i),window.Shiny.addCustomMessageHandler("masonry-restore-config",(n=>{e(n.target,n.config),(n=>{n.config.grid.map(((e,t)=>{$(`#${n.target}`).find(`.masonry-row:eq(${t})`).attr("id");const i=e.id;e.items.map(((e,t)=>{$(`#${n.target}`).find(`.masonry-item:eq(${t})`).attr("id");const r=e.id;$(`#${r}`).appendTo(`#${i}`)}))}))})(n),$(`#${n.target}`).find(".masonry-row").each(((e,t)=>{$(t).find(".masonry-item").each(((t,i)=>{$(i).css("width",`${n.config.grid[e].items[t].percentage}%`),$(i).trigger("resize")}))}))})),window.Shiny.addCustomMessageHandler("masonry-run",(n=>{setTimeout((()=>{$(`${n.target}`).masonry()}),n.delay)}))})();