(()=>{"use strict";Shiny;const e={},t=(t,n)=>{e[t]=n},n=t=>e[t.replace("#","")],r=e=>{let t=[];$(`#${e.target}`).find(".masonry-row").each(((e,n)=>{let r=[];$(n).find(".masonry-item").each(((e,t)=>{let n=[];$(t).children().each(((e,t)=>{n.push(t)}));let i="";n.length>0&&(i=$(n[0]).attr("id"));let a={width:o(t),id:$(t).attr("id"),childId:i};r.push(a)})),r.map((e=>e.width)).reduce(((e,t)=>e+t),0),r=r.map((e=>(e.percentage=Math.floor(100/r.length),e)));let i={id:$(n).attr("id"),items:r};t.push(i)}));let r={opts:n(`#${e.target}`),grid:t};console.log("--------"),console.log(r),window.Shiny.setInputValue(`${e.target}_config:force.raw`,r)},o=e=>$(e).width()||0,i=()=>"_"+Math.ceil(1e7*Math.random()),a=(e,n)=>{const o=$(e).attr("id");n.group=o,t(o,n),s(e,n),((e,t)=>{$(e).find(".masonry-item").on("mouseup",(e=>{$(e.target).trigger("resize")}))})(e),$(e).addClass("masoned"),y(e,n),l($(e).find(".masonry-grid-content"),n),$(e).data("send")&&($(e).off("change resize"),$(e).on("change resize",(()=>{r({target:o})})))},s=(e,t)=>{$(e).find(".masonry-row").each(((e,n)=>{d(n,t)}))},d=(e,t)=>{if(t.rows)for(const n in t.rows)$(e).css(n,t.rows[n]);$(e).attr("id")||$(e).attr("id",i()),w(e,t),m(e,t),y(e,t)},m=(e,t)=>{$(e).find(".masonry-item").each(((e,n)=>{c(n,t)})),g(e)},c=(e,t)=>{if(t.items)for(const n in t.items)$(e).css(n,t.items[n]);const n=i();$(e).attr("id",n)},g=e=>{let t=[];$(e).find(".masonry-item").each(((e,n)=>t.push(o(n))));const n=t.reduce(((e,t)=>e+t),0);$(e).find(".masonry-item").each(((e,t)=>{$(t).css("width",((e,t)=>Math.round(e/t*100))(o(t),n)+"%"),$(t).trigger("resize")}))},y=(e,t)=>{const n={multiDrag:!1,fallbackTolerance:2,animation:150,swap:!1,draggable:".masonry-item",onEnd:e=>{$(e.item).closest(".masonry-row").trigger("resize");const t=$(e.item).closest(".masonry-grid").attr("id");r({target:t})}};t.group&&(n.group=t.group),new window.Sortable(e,n)},l=(e,t)=>{const n={multiDrag:!1,fallbackTolerance:2,animation:150,swap:!1,draggable:".masonry-row",onEnd:e=>{$(e.item).trigger("resize");const t=$(e.item).closest(".masonry-grid").attr("id");r({target:t})}};new window.Sortable(e[0],n)},w=(e,t)=>{const n=[];if($(e).find(".masonry-item").each(((e,t)=>{n.push($(t).data("masonry-width")||.2)})),0==n.length)return;const r=n.reduce(((e,t)=>e+t),0);if(r<100){const t=100-r;$(e).find(".masonry-item").last().data("masonry-width",n[n.length-1]+t)}const o=r-100;$(e).find(".masonry-item").last().data("masonry-width",n[n.length-1]-o)},h=new window.Shiny.OutputBinding;$.extend(h,{find:function(e){return $(e).find(".masonry-grid-shiny")},renderValue:function(e,t){window.Shiny.renderContentAsync(e,t.content).then((()=>{$(e).masonry(t.options)}))}}),window.Shiny.outputBindings.register(h,"masonry.masonry"),jQuery.fn.extend({masonry:function(e){((e,t)=>{Array.isArray(t)&&(t=null),((e,t)=>{$(e).hasClass("masonry-grid")?a(e[0],t):$(e).find(".masonry-grid").each(((e,n)=>{a(n,t)}))})(e,t=t||$(e).data("styles")||{})})(this,e)}}),window.Shiny.addCustomMessageHandler("masonry-add-row",(e=>{e.id||(e.id=i());const t=`<div id="${e.id}" class='masonry-row d-flex ${e.classes}'></div>`,o=$(`${e.target}`).find(".masonry-grid-content");"bottom"==e.position&&o.append(t),"top"==e.position&&o.prepend(t),window.Shiny.renderDependenciesAsync(e.content.deps).then((()=>{window.Shiny.renderContentAsync($(`#${e.id}`),e.content.html).then((()=>{const t=n(e.target);$(`${e.target}`).masonry(t);const o=new CustomEvent("masonry:added-row",{detail:e.id});document.dispatchEvent(o),r({target:e.target.replace("#","")}),e.event_id&&window.Shiny.setInputValue(e.event_id,e)}))}))})),window.Shiny.addCustomMessageHandler("masonry-add-item",(e=>{console.info(e);let t=e.id;null!=t&&""!==t||(t=i());const o=`<div id="${t}" class='masonry-item ${e.classes}'></div>`;let a;e.row_id||(a=$(`${e.target}`).find(".masonry-grid-content").find(`.masonry-row:eq(${e.row_index})`)),e.row_id&&(a=$(`${e.row_id}`)),"end"==e.position&&a.append(o),"start"==e.position&&a.prepend(o),window.Shiny.renderDependenciesAsync(e.item.deps).then((()=>{window.Shiny.renderContentAsync($(`#${t}`),e.item.html).then((()=>{if(e.mason){const t=n(e.target);$(`${e.target}`).masonry(t)}console.log(t,"rendered"),console.log($(`#${t}`));const o=new CustomEvent("masonry:added-item",{detail:t});document.dispatchEvent(o),r({target:e.target.replace("#","")}),e.event_id&&window.Shiny.setInputValue(e.event_id,e)})).catch((e=>console.error(e)))})).catch((e=>console.error(e)))})),window.Shiny.addCustomMessageHandler("masonry-remove-item",(e=>{if(e.item_id)return void $(`#${e.item_id}`).remove();const t=$(`${e.target}`).closest(".masonry-grid").attr("id");$(`${e.target}`).find(".masonry-grid-content").find(`.masonry-row:eq(${e.row_index})`).find(`.masonry-item:eq(${e.item_index})`).remove(),r({target:t})})),window.Shiny.addCustomMessageHandler("masonry-remove-row",(e=>{const t=$(`${e.target}`).closest(".masonry-grid").attr("id");$(`${e.target}`).find(".masonry-grid-content").find(`.masonry-row:eq(${e.row_index})`).remove(),r({target:t})})),window.Shiny.addCustomMessageHandler("masonry-get-config",(e=>{setTimeout((()=>{r(e)}),e.delay||0)})),window.Shiny.addCustomMessageHandler("masonry-restore-config",(e=>{setTimeout((()=>{t(e.target,e.config?.opts),(e=>{e.config.grid.map(((t,n)=>{$(`#${e.target}`).find(`.masonry-row:eq(${n})`).attr("id");const r=t.id;t.items.map(((t,n)=>{$(`#${e.target}`).find(`.masonry-item:eq(${n})`).attr("id");const o=t.id;$(`#${o}`).appendTo(`#${r}`)}))}))})(e),$(`#${e.target}`).find(".masonry-row").each(((t,n)=>{$(n).find(".masonry-item").each(((n,r)=>{$(r).css("width",`${e.config.grid[t].items[n].percentage}%`),$(r).trigger("resize")}))})),n(`#${e.target}`)}),e.delay||0)})),window.Shiny.addCustomMessageHandler("masonry-run",(e=>{setTimeout((()=>{$(`${e.target}`).masonry()}),e.delay)}))})();