(()=>{"use strict";Shiny;const a=()=>"_"+Math.ceil(1e7*Math.random()),t={},n=a=>t[a],e=(a,n)=>{const e=$(a).attr("id");n.group=e,((a,n)=>{t[`#${a}`]=n})(e,n),s(a,n),((a,t)=>{$(a).find(".masonry-item").on("mouseup",(a=>{$(a.target).trigger("resize")}))})(a),$(a).addClass("masoned"),d(a,n)},s=(a,t)=>{$(a).find(".masonry-row").each(((a,n)=>{i(n,t)}))},i=(t,n)=>{const e=$(t).data("masonry-minheight");$(t).css("min-height",e);const s=$(t).data("masonry-height");s&&$(t).css("height",s),$(t).attr("id",a()),m(t,n),r(t,n),d(t,n)},r=(a,t)=>{$(a).find(".masonry-item").each(((a,n)=>{o(n,t)}))},o=(t,n)=>{n.padding&&$(t).css("padding",n.padding),n.margin&&$(t).css("margin",n.margin);let e=$(t).data("masonry-width");e||(e=20),$(t).css("width",`${e}%`);let s=a();$(t).attr("id",s)},d=(a,t)=>{let n={multiDrag:!1,fallbackTolerance:2,animation:150,swap:!1};t.group&&(n.group=t.group),new Sortable(a,n)},m=(a,t)=>{let n=[];if($(a).find(".masonry-item").each(((a,t)=>{n.push($(t).data("masonry-width")||.2)})),0==n.length)return;let e=n.reduce(((a,t)=>a+t));if(e<100){let t=100-e;$(a).find(".masonry-item").last().data("masonry-width",n[n.length-1]+t)}let s=e-100;$(a).find(".masonry-item").last().data("masonry-width",n[n.length-1]-s)};jQuery.fn.extend({masonry:function(a){((a,t)=>{((a,t)=>{$(a).hasClass("masonry-main")?e(a[0],t):$(a).find(".masonry-main").each(((a,n)=>{e(n,t)}))})(this,t=t||{})})(0,a)}}),Shiny.addCustomMessageHandler("masonry-init",(a=>{$(`${a.target}`).masonry()})),Shiny.addCustomMessageHandler("masonry-add-row",(a=>{let t=`<div \n    class='masonry-row d-flex ${a.classes}'\n    data-masonry-minheight = ${a.min_height}\n    data-masonry-height = ${a.height}\n    ></div>`,e=$(`${a.target}`).find(".masonry-main-content");"bottom"==a.position&&e.append(t),"top"==a.position&&e.prepend(t);const s=n(a.target);$(`${a.target}`).masonry(s)})),Shiny.addCustomMessageHandler("masonry-add-item",(a=>{let t=`<div class='masonry-item ${a.classes}'>${a.item}</div>`,e=$(`${a.target}`).find(".masonry-main-content").find(`.masonry-row:eq(${a.row_index})`);"end"==a.position&&e.append(t),"start"==a.position&&e.prepend(t);let s=n(a.target);$(`${a.target}`).masonry(s)})),Shiny.addCustomMessageHandler("masonry-get-config",(a=>{let t=[];$(`#${a.target}`).find(".masonry-row").each(((a,n)=>{let e=[];$(n).find(".masonry-item").each(((a,t)=>{let n={width:(s=t,$(s).width())};var s;e.push(n)}));let s=e.map((a=>a.width)).reduce(((a,t)=>a+t));e=e.map((a=>(a.percentage=((a,t)=>Math.round(a/t*100))(a.width,s),a))),t.push(e)})),Shiny.setInputValue(`${a.target}_config:force.raw`,t)}))})();