(()=>{"use strict";Shiny;const e=()=>"_"+Math.ceil(1e7*Math.random()),n={},t=e=>n[e.replace("#","")],r=(e,t)=>{const r=$(e).attr("id");t.group=r,((e,t)=>{n[`#${e}`]=t})(r,t),i(e,t),((e,n)=>{$(e).find(".masonry-item").on("mouseup",(e=>{$(e.target).trigger("resize")}))})(e),$(e).addClass("masoned"),d(e,t),m($(e).find(".masonry-grid-content"),t)},i=(e,n)=>{$(e).find(".masonry-row").each(((e,t)=>{a(t,n)}))},a=(n,t)=>{const r=$(n).data("masonry-minheight");$(n).css("min-height",r);const i=$(n).data("masonry-height");if(i&&$(n).css("height",i),t.rows)for(const e in t.rows)$(n).css(e,t.rows[e]);$(n).attr("id")||$(n).attr("id",e()),y(n,t),s(n,t),d(n,t)},s=(e,n)=>{$(e).find(".masonry-item").each(((e,t)=>{o(t,n)}))},o=(n,t)=>{if(t.items)for(const e in t.items)$(n).css(e,t.items[e]);let r=$(n).data("masonry-width");if(r||(r=20),$(n).css("width",`${r}%`),$(n).attr("id"))return;let i=e();$(n).attr("id",i)},d=(e,n)=>{let t={multiDrag:!1,fallbackTolerance:2,animation:150,swap:!1,draggable:".masonry-item",onEnd:e=>{$(e.item).closest(".masonry-row").trigger("resize")}};n.group&&(t.group=n.group),new Sortable(e,t)},m=(e,n)=>{let t={multiDrag:!1,fallbackTolerance:2,animation:150,swap:!1,draggable:".masonry-row",onEnd:e=>{$(e.item).trigger("resize")}};new Sortable(e[0],t)},y=(e,n)=>{let t=[];if($(e).find(".masonry-item").each(((e,n)=>{t.push($(n).data("masonry-width")||.2)})),0==t.length)return;let r=t.reduce(((e,n)=>e+n));if(r<100){let n=100-r;$(e).find(".masonry-item").last().data("masonry-width",t[t.length-1]+n)}let i=r-100;$(e).find(".masonry-item").last().data("masonry-width",t[t.length-1]-i)},c=new Shiny.OutputBinding;$.extend(c,{find:function(e){return $(e).find(".masonry-grid-shiny")},renderValue:function(e,n){Shiny.renderContentAsync(e,n.content).then((()=>{$(e).masonry(n.options)}))}}),Shiny.outputBindings.register(c,"masonry.masonry");jQuery.fn.extend({masonry:function(e){((e,n)=>{Array.isArray(n)&&(n=null),((e,n)=>{$(e).hasClass("masonry-grid")?r(e[0],n):$(e).find(".masonry-grid").each(((e,t)=>{r(t,n)}))})(e,n=n||$(e).data("styles")||{})})(this,e)}}),Shiny.addCustomMessageHandler("masonry-add-row",(n=>{n.id=e();const r=`<div id="${n.id}" class='masonry-row d-flex ${n.classes}'></div>`,i=$(`${n.target}`).find(".masonry-grid-content");"bottom"==n.position&&i.append(r),"top"==n.position&&i.prepend(r),Shiny.renderDependenciesAsync(n.content.deps).then((()=>{Shiny.renderContentAsync($(`#${n.id}`),n.content.html).then((()=>{const e=t(n.target);$(`${n.target}`).masonry(e);const r=new CustomEvent("masonry:added-row",{detail:n.id});document.dispatchEvent(r)}))}))})),Shiny.addCustomMessageHandler("masonry-add-item",(n=>{n.id=e();const r=`<div id="${n.id}" class='masonry-item ${n.classes}'></div>`;let i;n.row_id||(i=$(`${n.target}`).find(".masonry-grid-content").find(`.masonry-row:eq(${n.row_index})`)),n.row_id&&(i=$(`${n.row_id}`)),"end"==n.position&&i.append(r),"start"==n.position&&i.prepend(r),Shiny.renderDependenciesAsync(n.item.deps).then((()=>{Shiny.renderContentAsync($(`#${n.id}`),n.item.html).then((()=>{const e=t(n.target);$(`${n.target}`).masonry(e);const r=new CustomEvent("masonry:added-item",{detail:n.id});document.dispatchEvent(r)}))}))})),Shiny.addCustomMessageHandler("masonry-remove-item",(e=>{e.item_id?$(`#${e.item_id}`).remove():$(`${e.target}`).find(".masonry-grid-content").find(`.masonry-row:eq(${e.row_index})`).find(`.masonry-item:eq(${e.item_index})`).remove()})),Shiny.addCustomMessageHandler("masonry-remove-row",(e=>{$(`${e.target}`).find(".masonry-grid-content").find(`.masonry-row:eq(${e.row_index})`).remove()})),Shiny.addCustomMessageHandler("masonry-get-config",(e=>{let n=[];$(`#${e.target}`).find(".masonry-row").each(((e,t)=>{let r=[];$(t).find(".masonry-item").each(((e,n)=>{let t={width:(i=n,$(i).width()),id:$(n).attr("id")};var i;r.push(t)}));let i=r.map((e=>e.width)).reduce(((e,n)=>e+n));r=r.map((e=>(e.percentage=((e,n)=>Math.round(e/n*100))(e.width,i),e)));let a={id:$(t).attr("id"),items:r};n.push(a)}));let r={opts:t(`#${e.target}`),grid:n};Shiny.setInputValue(`${e.target}_config:force.raw`,r)})),Shiny.addCustomMessageHandler("masonry-restore-config",(e=>{(e=>{e.config.grid.map(((n,t)=>{$(`#${e.target}`).find(`.masonry-row:eq(${t})`).attr("id");const r=n.id;n.items.map(((n,t)=>{$(`#${e.target}`).find(`.masonry-item:eq(${t})`).attr("id");const i=n.id;$(`#${i}`).appendTo(`#${r}`)}))}))})(e),$(`#${e.target}`).find(".masonry-row").each(((n,t)=>{$(t).find(".masonry-item").each(((t,r)=>{$(r).css("width",`${e.config.grid[n].items[t].percentage}%`),$(r).trigger("resize")}))}))})),Shiny.addCustomMessageHandler("masonry-run",(e=>{$(e.target).masonry()}))})();