(()=>{"use strict";Shiny;const e={},t=(t,n)=>{e[t]=n},n=t=>e[t.replace("#","")],r=e=>{let t=[];$(`#${e.target}`).find(".masonry-row").each(((e,n)=>{let r=[];$(n).find(".masonry-item").each(((e,t)=>{let n=[];$(t).children().each(((e,t)=>{n.push(t)}));let i="";n.length>0&&(i=$(n[0]).attr("id"));let a={width:o(t),id:$(t).attr("id"),childId:i};r.push(a)}));let a=r.map((e=>e.width)).reduce(((e,t)=>e+t),0);r=r.map((e=>(e.percentage=i(e.width,a),e)));let s={id:$(n).attr("id"),items:r};t.push(s)}));let r={opts:n(`#${e.target}`),grid:t};window.Shiny.setInputValue(`${e.target}_config:force.raw`,r)},i=(e,t)=>Math.round(e/t*100),o=e=>{let t=$(e).css("width").replace("%","");return t?parseInt(t):$(e).width()||0},a=()=>"_"+Math.ceil(1e7*Math.random()),s=(e,n)=>{const i=$(e).attr("id");n.group=i,t(i,n),d(e,n),((e,t)=>{$(e).find(".masonry-item").on("mouseup",(e=>{$(e.target).trigger("resize")}))})(e),$(e).addClass("masoned"),l(e,n),w($(e).find(".masonry-grid-content"),n),$(e).data("send")&&($(e).off("change resize"),$(e).on("change resize",(()=>{r({target:i})})))},d=(e,t)=>{$(e).find(".masonry-row").each(((e,n)=>{m(n,t)}))},m=(e,t)=>{if(t.rows)for(const n in t.rows)$(e).css(n,t.rows[n]);$(e).attr("id")||$(e).attr("id",a()),h(e,t),c(e,t),l(e,t)},c=(e,t)=>{$(e).find(".masonry-item").each(((e,n)=>{g(n,t)})),y(e)},g=(e,t)=>{if(t.items)for(const n in t.items)$(e).css(n,t.items[n]);const n=a();$(e).attr("id",n)},y=e=>{let t=[];$(e).find(".masonry-item").each(((e,n)=>t.push(o(n))));const n=t.reduce(((e,t)=>e+t),0);$(e).find(".masonry-item").each(((e,t)=>{$(t).css("width",i(o(t),n)+"%"),$(t).trigger("resize")}))},l=(e,t)=>{const n={multiDrag:!1,fallbackTolerance:2,animation:150,swap:!1,draggable:".masonry-item",onEnd:e=>{$(e.item).closest(".masonry-row").trigger("resize");const t=$(e.item).closest(".masonry-grid").attr("id");r({target:t})}};t.group&&(n.group=t.group),new window.Sortable(e,n)},w=(e,t)=>{const n={multiDrag:!1,fallbackTolerance:2,animation:150,swap:!1,draggable:".masonry-row",onEnd:e=>{$(e.item).trigger("resize");const t=$(e.item).closest(".masonry-grid").attr("id");r({target:t})}};new window.Sortable(e[0],n)},h=(e,t)=>{const n=[];if($(e).find(".masonry-item").each(((e,t)=>{n.push($(t).data("masonry-width")||.2)})),0==n.length)return;const r=n.reduce(((e,t)=>e+t),0);if(r<100){const t=100-r;$(e).find(".masonry-item").last().data("masonry-width",n[n.length-1]+t)}const i=r-100;$(e).find(".masonry-item").last().data("masonry-width",n[n.length-1]-i)},u=new window.Shiny.OutputBinding;$.extend(u,{find:function(e){return $(e).find(".masonry-grid-shiny")},renderValue:function(e,t){window.Shiny.renderContentAsync(e,t.content).then((()=>{$(e).masonry(t.options)}))}}),window.Shiny.outputBindings.register(u,"masonry.masonry"),jQuery.fn.extend({masonry:function(e){((e,t)=>{Array.isArray(t)&&(t=null),((e,t)=>{$(e).hasClass("masonry-grid")?s(e[0],t):$(e).find(".masonry-grid").each(((e,n)=>{s(n,t)}))})(e,t=t||$(e).data("styles")||{})})(this,e)}}),window.Shiny.addCustomMessageHandler("masonry-add-row",(e=>{e.id||(e.id=a());const t=`<div id="${e.id}" class='masonry-row d-flex ${e.classes}'></div>`,i=$(`${e.target}`).find(".masonry-grid-content");"bottom"==e.position&&i.append(t),"top"==e.position&&i.prepend(t),window.Shiny.renderDependenciesAsync(e.content.deps).then((()=>{window.Shiny.renderContentAsync($(`#${e.id}`),e.content.html).then((()=>{const t=n(e.target);$(`${e.target}`).masonry(t);const i=new CustomEvent("masonry:added-row",{detail:e.id});document.dispatchEvent(i),r({target:e.target.replace("#","")}),e.event_id&&window.Shiny.setInputValue(e.event_id,e)}))}))})),window.Shiny.addCustomMessageHandler("masonry-add-item",(e=>{console.info(e);let t=e.id;null!=t&&""!==t||(t=a());const i=`<div id="${t}" class='masonry-item ${e.classes}'></div>`;let o;e.row_id||(o=$(`${e.target}`).find(".masonry-grid-content").find(`.masonry-row:eq(${e.row_index})`)),e.row_id&&(o=$(`${e.row_id}`)),"end"==e.position&&o.append(i),"start"==e.position&&o.prepend(i),window.Shiny.renderDependenciesAsync(e.item.deps).then((()=>{window.Shiny.renderContentAsync($(`#${t}`),e.item.html).then((()=>{if(e.mason){const t=n(e.target);$(`${e.target}`).masonry(t)}console.log(t,"rendered"),console.log(i);const o=new CustomEvent("masonry:added-item",{detail:e.id});document.dispatchEvent(o),r({target:e.target.replace("#","")}),e.event_id&&window.Shiny.setInputValue(e.event_id,e)})).catch((e=>console.error(e)))})).catch((e=>console.error(e)))})),window.Shiny.addCustomMessageHandler("masonry-remove-item",(e=>{if(e.item_id)return void $(`#${e.item_id}`).remove();const t=$(`${e.target}`).closest(".masonry-grid").attr("id");$(`${e.target}`).find(".masonry-grid-content").find(`.masonry-row:eq(${e.row_index})`).find(`.masonry-item:eq(${e.item_index})`).remove(),r({target:t})})),window.Shiny.addCustomMessageHandler("masonry-remove-row",(e=>{const t=$(`${e.target}`).closest(".masonry-grid").attr("id");$(`${e.target}`).find(".masonry-grid-content").find(`.masonry-row:eq(${e.row_index})`).remove(),r({target:t})})),window.Shiny.addCustomMessageHandler("masonry-get-config",(e=>{setTimeout((()=>{r(e)}),e.delay||0)})),window.Shiny.addCustomMessageHandler("masonry-restore-config",(e=>{setTimeout((()=>{t(e.target,e.config?.opts),(e=>{e.config.grid.map(((t,n)=>{$(`#${e.target}`).find(`.masonry-row:eq(${n})`).attr("id");const r=t.id;t.items.map(((t,n)=>{$(`#${e.target}`).find(`.masonry-item:eq(${n})`).attr("id");const i=t.id;$(`#${i}`).appendTo(`#${r}`)}))}))})(e),$(`#${e.target}`).find(".masonry-row").each(((t,n)=>{$(n).find(".masonry-item").each(((n,r)=>{$(r).css("width",`${e.config.grid[t].items[n].percentage}%`),$(r).trigger("resize")}))})),n(`#${e.target}`)}),e.delay||0)})),window.Shiny.addCustomMessageHandler("masonry-run",(e=>{setTimeout((()=>{$(`${e.target}`).masonry()}),e.delay)}))})();