(()=>{"use strict";Shiny;const e=()=>"_"+Math.ceil(1e7*Math.random()),t={},n=e=>t[e.replace("#","")],r=(e,n)=>{const r=$(e).attr("id");n.group=r,((e,n)=>{t[`#${e}`]=n})(r,n),i(e,n),((e,t)=>{$(e).find(".masonry-item").on("mouseup",(e=>{$(e.target).trigger("resize")}))})(e),$(e).addClass("masoned"),d(e,n),m($(e).find(".masonry-grid-content"),n)},i=(e,t)=>{$(e).find(".masonry-row").each(((e,n)=>{a(n,t)}))},a=(t,n)=>{const r=$(t).data("masonry-minheight");$(t).css("min-height",r);const i=$(t).data("masonry-height");if(i&&$(t).css("height",i),n.rows)for(const e in n.rows)$(t).css(e,n.rows[e]);$(t).attr("id")||$(t).attr("id",e()),y(t,n),s(t,n),d(t,n)},s=(e,t)=>{$(e).find(".masonry-item").each(((e,n)=>{o(n,t)}))},o=(t,n)=>{if(n.items)for(const e in n.items)$(t).css(e,n.items[e]);let r=$(t).data("masonry-width");if(r||(r=20),$(t).css("width",`${r}%`),$(t).attr("id"))return;let i=e();$(t).attr("id",i)},d=(e,t)=>{let n={multiDrag:!1,fallbackTolerance:2,animation:150,swap:!1,draggable:".masonry-item",onEnd:e=>{$(e.item).closest(".masonry-row").trigger("resize")}};t.group&&(n.group=t.group),new Sortable(e,n)},m=(e,t)=>{let n={multiDrag:!1,fallbackTolerance:2,animation:150,swap:!1,draggable:".masonry-row",onEnd:e=>{$(e.item).trigger("resize")}};new Sortable(e[0],n)},y=(e,t)=>{let n=[];if($(e).find(".masonry-item").each(((e,t)=>{n.push($(t).data("masonry-width")||.2)})),0==n.length)return;let r=n.reduce(((e,t)=>e+t));if(r<100){let t=100-r;$(e).find(".masonry-item").last().data("masonry-width",n[n.length-1]+t)}let i=r-100;$(e).find(".masonry-item").last().data("masonry-width",n[n.length-1]-i)};var c=new Shiny.OutputBinding;$.extend(c,{find:function(e){return $(e).find(".masonry-grid-shiny")},renderValue:function(e,t){Shiny.renderContentAsync(e,t.content).then((()=>{$(e).masonry(t.options)}))}}),Shiny.outputBindings.register(c,"masonry.masonry");jQuery.fn.extend({masonry:function(e){((e,t)=>{Array.isArray(t)&&(t=null),((e,t)=>{$(e).hasClass("masonry-grid")?r(e[0],t):$(e).find(".masonry-grid").each(((e,n)=>{r(n,t)}))})(e,t=t||$(e).data("styles")||{})})(this,e)}}),Shiny.addCustomMessageHandler("masonry-add-row",(t=>{t.id=e();let r=`<div id="${t.id}" class='masonry-row d-flex ${t.classes}'></div>`,i=$(`${t.target}`).find(".masonry-grid-content");"bottom"==t.position&&i.append(r),"top"==t.position&&i.prepend(r),Shiny.renderDependenciesAsync(t.content.deps).then((()=>{Shiny.renderContentAsync($(`#${t.id}`),t.content.html).then((()=>{const e=n(t.target);$(`${t.target}`).masonry(e);const r=new CustomEvent("masonry:added-row",{detail:t.id});document.dispatchEvent(r)}))}))})),Shiny.addCustomMessageHandler("masonry-add-item",(t=>{t.id=e();let r,i=`<div id="${t.id}" class='masonry-item ${t.classes}'></div>`;t.row_id||(r=$(`${t.target}`).find(".masonry-grid-content").find(`.masonry-row:eq(${t.row_index})`)),t.row_id&&(r=$(`${t.row_id}`)),"end"==t.position&&r.append(i),"start"==t.position&&r.prepend(i),Shiny.renderDependenciesAsync(t.item.deps).then((()=>{Shiny.renderContentAsync($(`#${t.id}`),t.item.html).then((()=>{const e=n(t.target);$(`${t.target}`).masonry(e);const r=new CustomEvent("masonry:added-item",{detail:t.id});document.dispatchEvent(r)}))}))})),Shiny.addCustomMessageHandler("masonry-remove-item",(e=>{e.item_id?$(`#${e.item_id}`).remove():$(`${e.target}`).find(".masonry-grid-content").find(`.masonry-row:eq(${e.row_index})`).find(`.masonry-item:eq(${e.item_index})`).remove()})),Shiny.addCustomMessageHandler("masonry-remove-row",(e=>{$(`${e.target}`).find(".masonry-grid-content").find(`.masonry-row:eq(${e.row_index})`).remove()})),Shiny.addCustomMessageHandler("masonry-get-config",(e=>{let t=[];$(`#${e.target}`).find(".masonry-row").each(((e,n)=>{let r=[];$(n).find(".masonry-item").each(((e,t)=>{let n={width:(i=t,$(i).width()),id:$(t).attr("id")};var i;r.push(n)}));let i=r.map((e=>e.width)).reduce(((e,t)=>e+t));r=r.map((e=>(e.percentage=((e,t)=>Math.round(e/t*100))(e.width,i),e)));let a={id:$(n).attr("id"),items:r};t.push(a)}));let r={opts:n(`#${e.target}`),grid:t};Shiny.setInputValue(`${e.target}_config:force.raw`,r)})),Shiny.addCustomMessageHandler("masonry-restore-config",(e=>{(e=>{e.config.grid.map(((t,n)=>{$(`#${e.target}`).find(`.masonry-row:eq(${n})`).attr("id");const r=t.id;t.items.map(((t,n)=>{$(`#${e.target}`).find(`.masonry-item:eq(${n})`).attr("id");const i=t.id;$(`#${i}`).appendTo(`#${r}`)}))}))})(e),$(`#${e.target}`).find(".masonry-row").each(((t,n)=>{$(n).find(".masonry-item").each(((n,r)=>{$(r).css("width",`${e.config.grid[t].items[n].percentage}%`),$(r).trigger("resize")}))}))})),Shiny.addCustomMessageHandler("masonry-run",(e=>{$(e.target).masonry()}))})();