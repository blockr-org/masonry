(()=>{"use strict";Shiny;const e=()=>"_"+Math.ceil(1e7*Math.random()),n={},t=e=>n[e],a=(e,t)=>{const a=$(e).attr("id");t.group=a,((e,t)=>{n[`#${e}`]=t})(a,t),r(e,t),((e,n)=>{$(e).find(".masonry-item").on("mouseup",(e=>{$(e.target).trigger("resize")}))})(e),$(e).addClass("masoned"),d(e,t)},r=(e,n)=>{$(e).find(".masonry-row").each(((e,t)=>{i(t,n)}))},i=(n,t)=>{const a=$(n).data("masonry-minheight");$(n).css("min-height",a);const r=$(n).data("masonry-height");r&&$(n).css("height",r),$(n).attr("id",e()),m(n,t),s(n,t),d(n,t)},s=(e,n)=>{$(e).find(".masonry-item").each(((e,t)=>{o(t,n)}))},o=(n,t)=>{t.padding&&$(n).css("padding",t.padding),t.margin&&$(n).css("margin",t.margin);let a=$(n).data("masonry-width");a||(a=20),$(n).css("width",`${a}%`);let r=e();$(n).attr("id",r)},d=(e,n)=>{let t={multiDrag:!1,fallbackTolerance:2,animation:150,swap:!1,onEnd:e=>{$(e.item).trigger("resize")}};n.group&&(t.group=n.group),new Sortable(e,t)},m=(e,n)=>{let t=[];if($(e).find(".masonry-item").each(((e,n)=>{t.push($(n).data("masonry-width")||.2)})),0==t.length)return;let a=t.reduce(((e,n)=>e+n));if(a<100){let n=100-a;$(e).find(".masonry-item").last().data("masonry-width",t[t.length-1]+n)}let r=a-100;$(e).find(".masonry-item").last().data("masonry-width",t[t.length-1]-r)};jQuery.fn.extend({masonry:function(e){((e,n)=>{((e,n)=>{$(e).hasClass("masonry-grid")?a(e[0],n):$(e).find(".masonry-grid").each(((e,t)=>{a(t,n)}))})(this,n=n||{})})(0,e)}}),Shiny.addCustomMessageHandler("masonry-add-row",(e=>{let n=`<div \n    class='masonry-row d-flex ${e.classes}'\n    data-masonry-minheight = ${e.min_height}\n    data-masonry-height = ${e.height}\n    ></div>`,a=$(`${e.target}`).find(".masonry-grid-content");"bottom"==e.position&&a.append(n),"top"==e.position&&a.prepend(n);const r=t(e.target);$(`${e.target}`).masonry(r)})),Shiny.addCustomMessageHandler("masonry-add-item",(e=>{let n=`<div class='masonry-item ${e.classes}'>${e.item}</div>`,a=$(`${e.target}`).find(".masonry-grid-content").find(`.masonry-row:eq(${e.row_index})`);"end"==e.position&&a.append(n),"start"==e.position&&a.prepend(n);let r=t(e.target);$(`${e.target}`).masonry(r)})),Shiny.addCustomMessageHandler("masonry-remove-item",(e=>{$(`${e.target}`).find(".masonry-grid-content").find(`.masonry-row:eq(${e.row_index})`).find(`.masonry-item:eq(${e.item_index})`).remove()})),Shiny.addCustomMessageHandler("masonry-remove-row",(e=>{$(`${e.target}`).find(".masonry-grid-content").find(`.masonry-row:eq(${e.row_index})`).remove()})),Shiny.addCustomMessageHandler("masonry-get-config",(e=>{let n=[];$(`#${e.target}`).find(".masonry-row").each(((e,t)=>{let a=[];$(t).find(".masonry-item").each(((e,n)=>{let t={width:(r=n,$(r).width())};var r;a.push(t)}));let r=a.map((e=>e.width)).reduce(((e,n)=>e+n));a=a.map((e=>(e.percentage=((e,n)=>Math.round(e/n*100))(e.width,r),e))),n.push(a)}));let a={opts:t(`#${e.target}`),dimensions:n};Shiny.setInputValue(`${e.target}_config:force.raw`,a)})),Shiny.addCustomMessageHandler("masonry-restore-config",(e=>{console.log(e),$(`#${e.target}`).find(".masonry-row").each(((n,t)=>{$(t).find(".masonry-item").each(((t,a)=>{$(a).css("width",`${e.config.dimensions[n][t].percentage}%`),$(a).trigger("resize")}))}))}))})();