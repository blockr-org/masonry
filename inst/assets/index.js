(()=>{"use strict";Shiny;const e={},t=(t,n)=>{e[t]=n},n=t=>e[t.replace("#","")],i=e=>{let t=[];$(`#${e.target}`).find(".masonry-row").each(((e,n)=>{let i=[];$(n).find(".masonry-item").each(((e,t)=>{let n=[];$(t).children().each(((e,t)=>{n.push(t)}));let r="";n.length>0&&(r=$(n[0]).attr("id"));let o={width:a(t),id:$(t).attr("id"),childId:r};i.push(o)}));let o=i.map((e=>e.width)).reduce(((e,t)=>e+t),0);i=i.map((e=>(e.percentage=r(e.width,o),e)));let s={id:$(n).attr("id"),items:i};t.push(s)}));let i={opts:n(`#${e.target}`),grid:t};window.Shiny.setInputValue(`${e.target}_config:force.raw`,i)},r=(e,t)=>Math.round(e/t*100),a=e=>{let t=$(e).css("width").replace("%","");return t?parseInt(t):$(e).width()||0},o=()=>"_"+Math.ceil(1e7*Math.random()),s=(e,n)=>{const r=$(e).attr("id");n.group=r,t(r,n),d(e,n),((e,t)=>{$(e).find(".masonry-item").on("mouseup",(e=>{$(e.target).trigger("resize")}))})(e),$(e).addClass("masoned"),w(e,n),l($(e).find(".masonry-grid-content"),n),$(e).data("send")&&($(e).off("change resize"),$(e).on("change resize",(()=>{i({target:r})})))},d=(e,t)=>{$(e).find(".masonry-row").each(((e,n)=>{m(n,t)}))},m=(e,t)=>{if(t.rows)for(const n in t.rows)$(e).css(n,t.rows[n]);$(e).attr("id")||$(e).attr("id",o()),h(e,t),c(e,t),w(e,t)},c=(e,t)=>{$(e).find(".masonry-item").each(((e,n)=>{g(n,t)})),y(e)},g=(e,t)=>{if(t.items)for(const n in t.items)$(e).css(n,t.items[n]);const n=o();$(e).attr("id",n)},y=e=>{let t=[];$(e).find(".masonry-item").each(((e,n)=>t.push(a(n))));const n=t.reduce(((e,t)=>e+t),0);$(e).find(".masonry-item").each(((e,t)=>{$(t).css("width",r(a(t),n)+"%"),$(t).trigger("resize")}))},w=(e,t)=>{const n={multiDrag:!1,fallbackTolerance:2,animation:150,swap:!1,draggable:".masonry-item",onEnd:e=>{$(e.item).closest(".masonry-row").trigger("resize");const t=$(e.item).closest(".masonry-grid").attr("id");i({target:t})}};t.group&&(n.group=t.group),new window.Sortable(e,n)},l=(e,t)=>{const n={multiDrag:!1,fallbackTolerance:2,animation:150,swap:!1,draggable:".masonry-row",onEnd:e=>{$(e.item).trigger("resize");const t=$(e.item).closest(".masonry-grid").attr("id");i({target:t})}};new window.Sortable(e[0],n)},h=(e,t)=>{const n=[];if($(e).find(".masonry-item").each(((e,t)=>{n.push($(t).data("masonry-width")||.2)})),0==n.length)return;const i=n.reduce(((e,t)=>e+t),0);if(i<100){const t=100-i;$(e).find(".masonry-item").last().data("masonry-width",n[n.length-1]+t)}const r=i-100;$(e).find(".masonry-item").last().data("masonry-width",n[n.length-1]-r)},u=new window.Shiny.OutputBinding;$.extend(u,{find:function(e){return $(e).find(".masonry-grid-shiny")},renderValue:function(e,t){window.Shiny.renderContentAsync(e,t.content).then((()=>{$(e).masonry(t.options)}))}}),window.Shiny.outputBindings.register(u,"masonry.masonry"),jQuery.fn.extend({masonry:function(e){((e,t)=>{Array.isArray(t)&&(t=null),((e,t)=>{$(e).hasClass("masonry-grid")?s(e[0],t):$(e).find(".masonry-grid").each(((e,n)=>{s(n,t)}))})(e,t=t||$(e).data("styles")||{})})(this,e)}}),window.Shiny.addCustomMessageHandler("masonry-add-row",(e=>{e.id||(e.id=o());const t=`<div id="${e.id}" class='masonry-row d-flex ${e.classes}'></div>`,r=$(`${e.target}`).find(".masonry-grid-content");"bottom"==e.position&&r.append(t),"top"==e.position&&r.prepend(t),window.Shiny.renderDependenciesAsync(e.content.deps).then((()=>{window.Shiny.renderContentAsync($(`#${e.id}`),e.content.html).then((()=>{const t=n(e.target);$(`${e.target}`).masonry(t);const r=new CustomEvent("masonry:added-row",{detail:e.id});document.dispatchEvent(r),i({target:e.target.replace("#","")}),e.event_id&&window.Shiny.setInputValue(e.event_id,e)}))}))})),window.Shiny.addCustomMessageHandler("masonry-add-item",(e=>{setTimeout((()=>{e.id=o();const t=`<div id="${e.id}" class='masonry-item ${e.classes}'></div>`;let r;e.row_id||(r=$(`${e.target}`).find(".masonry-grid-content").find(`.masonry-row:eq(${e.row_index})`)),e.row_id&&(r=$(`${e.row_id}`)),"end"==e.position&&r.append(t),"start"==e.position&&r.prepend(t),window.Shiny.renderDependenciesAsync(e.item.deps).then((()=>{window.Shiny.renderContentAsync($(`#${e.id}`),e.item.html).then((()=>{const t=n(e.target);$(`${e.target}`).masonry(t);const r=new CustomEvent("masonry:added-item",{detail:e.id});document.dispatchEvent(r),i({target:e.target.replace("#","")}),e.event_id&&window.Shiny.setInputValue(e.event_id,e)}))}))}),e.delay||0)})),window.Shiny.addCustomMessageHandler("masonry-remove-item",(e=>{if(e.item_id)return void $(`#${e.item_id}`).remove();const t=$(`${e.target}`).closest(".masonry-grid").attr("id");$(`${e.target}`).find(".masonry-grid-content").find(`.masonry-row:eq(${e.row_index})`).find(`.masonry-item:eq(${e.item_index})`).remove(),i({target:t})})),window.Shiny.addCustomMessageHandler("masonry-remove-row",(e=>{const t=$(`${e.target}`).closest(".masonry-grid").attr("id");$(`${e.target}`).find(".masonry-grid-content").find(`.masonry-row:eq(${e.row_index})`).remove(),i({target:t})})),window.Shiny.addCustomMessageHandler("masonry-get-config",(e=>{setTimeout((()=>{i(e)}),e.delay||0)})),window.Shiny.addCustomMessageHandler("masonry-restore-config",(e=>{setTimeout((()=>{t(e.target,e.config?.opts),(e=>{e.config.grid.map(((t,n)=>{$(`#${e.target}`).find(`.masonry-row:eq(${n})`).attr("id");const i=t.id;t.items.map(((t,n)=>{$(`#${e.target}`).find(`.masonry-item:eq(${n})`).attr("id");const r=t.id;$(`#${r}`).appendTo(`#${i}`)}))}))})(e),$(`#${e.target}`).find(".masonry-row").each(((t,n)=>{$(n).find(".masonry-item").each(((n,i)=>{$(i).css("width",`${e.config.grid[t].items[n].percentage}%`),$(i).trigger("resize")}))})),n(`#${e.target}`)}),e.delay||0)})),window.Shiny.addCustomMessageHandler("masonry-run",(e=>{setTimeout((()=>{$(`${e.target}`).masonry()}),e.delay)}))})();