(()=>{"use strict";Shiny;const e=()=>"_"+Math.ceil(1e7*Math.random()),t={},n=e=>t[e],a=(e,n)=>{const a=$(e).attr("id");n.group=a,((e,n)=>{t[`#${e}`]=n})(a,n),r(e,n),((e,t)=>{$(e).find(".masonry-item").on("mouseup",(e=>{$(e.target).trigger("resize")}))})(e),$(e).addClass("masoned"),d(e,n),m($(e).find(".masonry-grid-content"),n)},r=(e,t)=>{$(e).find(".masonry-row").each(((e,n)=>{i(n,t)}))},i=(t,n)=>{const a=$(t).data("masonry-minheight");$(t).css("min-height",a);const r=$(t).data("masonry-height");r&&$(t).css("height",r),$(t).attr("id")||$(t).attr("id",e()),g(t,n),s(t,n),d(t,n)},s=(e,t)=>{$(e).find(".masonry-item").each(((e,n)=>{o(n,t)}))},o=(t,n)=>{if(n.items)for(const e in n.items)$(t).css(e,n.items[e]);let a=$(t).data("masonry-width");if(a||(a=20),$(t).css("width",`${a}%`),$(t).attr("id"))return;let r=e();$(t).attr("id",r)},d=(e,t)=>{let n={multiDrag:!1,fallbackTolerance:2,animation:150,swap:!1,onEnd:e=>{$(e.item).closest(".masonry-row").trigger("resize")}};t.group&&(n.group=t.group),new Sortable(e,n)},m=(e,t)=>{let n={multiDrag:!1,fallbackTolerance:2,animation:150,swap:!1,onEnd:e=>{$(e.item).trigger("resize")}};new Sortable(e[0],n)},g=(e,t)=>{let n=[];if($(e).find(".masonry-item").each(((e,t)=>{n.push($(t).data("masonry-width")||.2)})),0==n.length)return;let a=n.reduce(((e,t)=>e+t));if(a<100){let t=100-a;$(e).find(".masonry-item").last().data("masonry-width",n[n.length-1]+t)}let r=a-100;$(e).find(".masonry-item").last().data("masonry-width",n[n.length-1]-r)};jQuery.fn.extend({masonry:function(e){((e,t)=>{((e,t)=>{$(e).hasClass("masonry-grid")?a(e[0],t):$(e).find(".masonry-grid").each(((e,n)=>{a(n,t)}))})(this,t=t||{})})(0,e)}}),Shiny.addCustomMessageHandler("masonry-add-row",(e=>{let t=`<div \n    class='masonry-row d-flex ${e.classes}'\n    data-masonry-minheight = ${e.min_height}\n    data-masonry-height = ${e.height}\n    ></div>`,a=$(`${e.target}`).find(".masonry-grid-content");"bottom"==e.position&&a.append(t),"top"==e.position&&a.prepend(t);const r=n(e.target);$(`${e.target}`).masonry(r)})),Shiny.addCustomMessageHandler("masonry-add-item",(e=>{let t=`<div class='masonry-item ${e.classes}'>${e.item}</div>`,a=$(`${e.target}`).find(".masonry-grid-content").find(`.masonry-row:eq(${e.row_index})`);"end"==e.position&&a.append(t),"start"==e.position&&a.prepend(t);let r=n(e.target);$(`${e.target}`).masonry(r)})),Shiny.addCustomMessageHandler("masonry-remove-item",(e=>{$(`${e.target}`).find(".masonry-grid-content").find(`.masonry-row:eq(${e.row_index})`).find(`.masonry-item:eq(${e.item_index})`).remove()})),Shiny.addCustomMessageHandler("masonry-remove-row",(e=>{$(`${e.target}`).find(".masonry-grid-content").find(`.masonry-row:eq(${e.row_index})`).remove()})),Shiny.addCustomMessageHandler("masonry-get-config",(e=>{let t=[];$(`#${e.target}`).find(".masonry-row").each(((e,n)=>{let a=[];$(n).find(".masonry-item").each(((e,t)=>{let n={width:(r=t,$(r).width()),id:$(t).attr("id")};var r;a.push(n)}));let r=a.map((e=>e.width)).reduce(((e,t)=>e+t));a=a.map((e=>(e.percentage=((e,t)=>Math.round(e/t*100))(e.width,r),e))),t.push(a)}));let a={opts:n(`#${e.target}`),items:t};console.log(a),Shiny.setInputValue(`${e.target}_config:force.raw`,a)})),Shiny.addCustomMessageHandler("masonry-restore-config",(e=>{$(`#${e.target}`).find(".masonry-row").each(((t,n)=>{$(n).find(".masonry-item").each(((n,a)=>{$(a).css("width",`${e.config.items[t][n].percentage}%`),$(a).trigger("resize")}))}))}))})();