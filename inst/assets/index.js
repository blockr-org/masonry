(()=>{"use strict";Shiny;const e=()=>"_"+Math.ceil(1e7*Math.random()),t={},a=e=>t[e],n=(e,a)=>{const n=$(e).attr("id");a.group=n,((e,a)=>{t[`#${e}`]=a})(n,a),r(e,a),((e,t)=>{$(e).find(".masonry-item").on("mouseup",(e=>{$(e.target).trigger("resize")}))})(e),$(e).addClass("masoned"),d(e,a),m($(e).find(".masonry-grid-content"),a)},r=(e,t)=>{$(e).find(".masonry-row").each(((e,a)=>{i(a,t)}))},i=(t,a)=>{const n=$(t).data("masonry-minheight");$(t).css("min-height",n);const r=$(t).data("masonry-height");r&&$(t).css("height",r),$(t).attr("id")||$(t).attr("id",e()),g(t,a),s(t,a),d(t,a)},s=(e,t)=>{$(e).find(".masonry-item").each(((e,a)=>{o(a,t)}))},o=(t,a)=>{a.padding&&$(t).css("padding",a.padding),a.margin&&$(t).css("margin",a.margin);let n=$(t).data("masonry-width");if(n||(n=20),$(t).css("width",`${n}%`),$(t).attr("id"))return;let r=e();$(t).attr("id",r)},d=(e,t)=>{let a={multiDrag:!1,fallbackTolerance:2,animation:150,swap:!1,onEnd:e=>{$(e.item).closest(".masonry-row").trigger("resize")}};t.group&&(a.group=t.group),new Sortable(e,a)},m=(e,t)=>{let a={multiDrag:!1,fallbackTolerance:2,animation:150,swap:!1,onEnd:e=>{$(e.item).trigger("resize")}};new Sortable(e[0],a)},g=(e,t)=>{let a=[];if($(e).find(".masonry-item").each(((e,t)=>{a.push($(t).data("masonry-width")||.2)})),0==a.length)return;let n=a.reduce(((e,t)=>e+t));if(n<100){let t=100-n;$(e).find(".masonry-item").last().data("masonry-width",a[a.length-1]+t)}let r=n-100;$(e).find(".masonry-item").last().data("masonry-width",a[a.length-1]-r)};jQuery.fn.extend({masonry:function(e){((e,t)=>{((e,t)=>{$(e).hasClass("masonry-grid")?n(e[0],t):$(e).find(".masonry-grid").each(((e,a)=>{n(a,t)}))})(this,t=t||{})})(0,e)}}),Shiny.addCustomMessageHandler("masonry-add-row",(e=>{let t=`<div \n    class='masonry-row d-flex ${e.classes}'\n    data-masonry-minheight = ${e.min_height}\n    data-masonry-height = ${e.height}\n    ></div>`,n=$(`${e.target}`).find(".masonry-grid-content");"bottom"==e.position&&n.append(t),"top"==e.position&&n.prepend(t);const r=a(e.target);$(`${e.target}`).masonry(r)})),Shiny.addCustomMessageHandler("masonry-add-item",(e=>{let t=`<div class='masonry-item ${e.classes}'>${e.item}</div>`,n=$(`${e.target}`).find(".masonry-grid-content").find(`.masonry-row:eq(${e.row_index})`);"end"==e.position&&n.append(t),"start"==e.position&&n.prepend(t);let r=a(e.target);$(`${e.target}`).masonry(r)})),Shiny.addCustomMessageHandler("masonry-remove-item",(e=>{$(`${e.target}`).find(".masonry-grid-content").find(`.masonry-row:eq(${e.row_index})`).find(`.masonry-item:eq(${e.item_index})`).remove()})),Shiny.addCustomMessageHandler("masonry-remove-row",(e=>{$(`${e.target}`).find(".masonry-grid-content").find(`.masonry-row:eq(${e.row_index})`).remove()})),Shiny.addCustomMessageHandler("masonry-get-config",(e=>{let t=[];$(`#${e.target}`).find(".masonry-row").each(((e,a)=>{let n=[];$(a).find(".masonry-item").each(((e,t)=>{let a={width:(r=t,$(r).width()),id:$(t).attr("id")};var r;n.push(a)}));let r=n.map((e=>e.width)).reduce(((e,t)=>e+t));n=n.map((e=>(e.percentage=((e,t)=>Math.round(e/t*100))(e.width,r),e))),t.push(n)}));let n={opts:a(`#${e.target}`),items:t};console.log(n),Shiny.setInputValue(`${e.target}_config:force.raw`,n)})),Shiny.addCustomMessageHandler("masonry-restore-config",(e=>{$(`#${e.target}`).find(".masonry-row").each(((t,a)=>{$(a).find(".masonry-item").each(((a,n)=>{$(n).css("width",`${e.config.items[t][a].percentage}%`),$(n).trigger("resize")}))}))}))})();